// ุณุณุชู ุชููุฏ ฺฉูพุดู ุขููุงู ุจุง ุงุณุชูุงุฏู ุงุฒ ุงูฺฏููุง ุงุฒ ูพุด ุชุนุฑู ุดุฏู
// ุงู ุณุณุชู ุฏุฑ ุตูุฑุช ุนุฏู ุฏุณุชุฑุณ ุจู API ูุงฺฏูฺฏ ูุณ ุงุณุชูุงุฏู ูโุดูุฏ

interface OfflineCaptionOptions {
  topic: string
  style: "casual" | "professional" | "creative" | "motivational"
  length: "short" | "medium" | "long"
  includeHashtags: boolean
}

export interface CaptionRequest {
  topic: string
  style?: "casual" | "professional" | "creative" | "motivational"
  length?: "short" | "medium" | "long"
  includeHashtags?: boolean
  language?: string
}

export interface CaptionResponse {
  caption: string
  hashtags?: string[]
  success: boolean
  error?: string
}

// ูุฌููุนู ฺฉูพุดูโูุง ุขูุงุฏู ุจุฑุง ููุถูุนุงุช ูุฎุชูู
const captionTemplates: Record<string, string[]> = {
  // ููุถูุนุงุช ฺฉุณุจ ู ฺฉุงุฑ
  business: [
    "๐ [ููุถูุน] ูุง ุฑุง ูุชูุงุฒ ูโฺฉูุฏ\n\nโจ ฺฉูุชุ ุชุนูุฏ ู ููุขูุฑ\n๐ผ ุฑุงูโุญูโูุง ุญุฑููโุง ุจุฑุง ูุงุฒูุง ุดูุง\n๐ ููุฑุงู ุจุง ุดูุง ุฏุฑ ูุณุฑ ููููุช\n\nูุธุฑ ุดูุง ุฏุฑุจุงุฑู [ููุถูุน] ฺุณุชุ ๐ญ",
    "๐ก ุงุฏูโูุง ูู ุจุฑุง [ููุถูุน]\n\n๐ ูฺฏุงู ูุชูุงูุช ุจู ฺฉุณุจ ู ฺฉุงุฑ\n๐ฏ ูุฏูโฺฏุฐุงุฑ ููุดููุฏุงูู\n๐ค ููฺฉุงุฑ ุจุฑุฏ-ุจุฑุฏ\n\nุดูุง ฺู ุฑุงูฺฉุงุฑ ุจุฑุง ุจูุจูุฏ [ููุถูุน] ุฏุงุฑุฏุ ๐",
  ],

  // ููุถูุนุงุช ุณุจฺฉ ุฒูุฏฺฏ
  lifestyle: [
    "โจ [ููุถูุน] ุจุฎุด ุงุฒ ุณุจฺฉ ุฒูุฏฺฏ ุณุงูู\n\n๐ฟ ุชุนุงุฏู ุฏุฑ ุฒูุฏฺฏ ุฑูุฒูุฑู\n๐งโโ๏ธ ุขุฑุงูุด ุฏุฑููุ ุดุงุฏ ุจุฑูู\n๐ซ ูุฐุช ุจุฑุฏู ุงุฒ ูุญุธุงุช ฺฉูฺฺฉ\n\nุดูุง ฺุทูุฑ [ููุถูุน] ุฑุง ุฏุฑ ุฒูุฏฺฏ ุฎูุฏ ุฌุง ูโุฏูุฏุ ๐ค",
    "๐ ุฑูฺฏุงุฑูฺฏ ุฒูุฏฺฏ ุจุง [ููุถูุน]\n\n๐ ูุฑ ุฑูุฒุ ูุฑุตุช ุจุฑุง ุชุฌุฑุจูโูุง ุฌุฏุฏ\n๐ญ ุฐูู ุขุฑุงูุ ุฒูุฏฺฏ ุดุงุฏ\nโจ ุฌุงุฏู ูุญุธุงุช ุณุงุฏู\n\nุจูุชุฑู ุชุฌุฑุจู ุดูุง ุงุฒ [ููุถูุน] ฺุณุชุ ๐ซ",
  ],

  // ููุถูุนุงุช ุบุฐุง
  food: [
    "๐ ูุฐุช [ููุถูุน] ุฏุฑ ูุฑ ูููู\n\n๐จโ๐ณ ููุฑ ุขุดูพุฒ ุจุง ุนุดู\n๐ฝ๏ธ ุทุนูโูุง ุจู ุงุฏูุงูุฏู\n๐ฟ ููุงุฏ ุชุงุฒูุ ุทุนู ุงุตู\n\nุดูุง ูู ุนุงุดู [ููุถูุน] ูุณุชุฏุ ๐คค",
    "๐ณ ุฑุงุฒูุง [ููุถูุน] ุฎูุดูุฒู\n\nโจ ุชุฑฺฉุจ ุทุนูโูุง ุจโูุธุฑ\n๐ถ๏ธ ฺุงุดู ุนุดู ุฏุฑ ูุฑ ูุนุฏู\n๐ฝ๏ธ ุชุฌุฑุจูโุง ูุฑุงุชุฑ ุงุฒ ฺฉ ุบุฐุง\n\nุจูุชุฑู ุฎุงุทุฑู ุดูุง ุงุฒ [ููุถูุน] ฺุณุชุ ๐",
  ],

  // ููุถูุนุงุช ุณูุฑ
  travel: [
    "โ๏ธ ุณูุฑ ุจู [ููุถูุน]ุ ุฑูุง ฺฉู ุจู ุญููุช ูพูุณุช\n\n๐ ฺฉุดู ูฺฉุงูโูุง ูุงุดูุงุฎุชู\n๐ธ ุซุจุช ูุญุธุงุช ูุงูุฏฺฏุงุฑ\n๐งณ ฺฉูููโุจุงุฑ ุงุฒ ุฎุงุทุฑุงุช\n\nููุตุฏ ุฑูุง ุจุนุฏ ุดูุง ฺฉุฌุงุณุชุ ๐บ๏ธ",
    "๐๏ธ ุฒุจุงโูุง ูพููุงู [ููุถูุน]\n\n๐ ุทููุน ุฏุฑ ุณุฑุฒููโูุง ุฏูุฑ\n๐ถโโ๏ธ ูุฏู ุฒุฏู ุฏุฑ ูุณุฑูุง ูุงุดูุงุฎุชู\nโจ ุฌุงุฏู ูุญุธุงุช ุณูุฑ\n\nฺฉุฏุงู ฺฏูุดู ุงุฒ [ููุถูุน] ุดูุง ุฑุง ูุฌุฐูุจ ฺฉุฑุฏุ ๐ซ",
  ],

  // ููุถูุนุงุช ููุฑ
  art: [
    "๐จ ููุฑ [ููุถูุน]ุ ุจุงู ุงุญุณุงุณุงุช ุฏุฑูู\n\nโจ ุฎูุงูุช ุจโูพุงุงู\n๐๏ธ ุฑูฺฏโูุง ุญุฑู ูโุฒููุฏ\n๐ซ ุงููุงู ุงุฒ ุฏูุง ุงุทุฑุงู\n\nููุฑ ุจุฑุง ุดูุง ฺู ูุนูุง ุฏุงุฑุฏุ ๐ญ",
    "๐ผ๏ธ ุฏูุง ุฑูฺฏุงุฑูฺฏ [ููุถูุน]\n\n๐ ูุฑ ุงุซุฑุ ุฏุงุณุชุงู ุฏุงุฑุฏ\nโจ ุฌุงุฏู ุขูุฑูุด\n๐ญ ุจุงู ุจโูุงุณุทู ุงุญุณุงุณุงุช\n\nฺฉุฏุงู ุณุจฺฉ ููุฑ ุดูุง ุฑุง ุจุดุชุฑ ูุฌุฐูุจ ูโฺฉูุฏุ ๐ค",
  ],

  // ููุถูุนุงุช ุงูฺฏุฒุด
  motivational: [
    "๐ช [ููุถูุน]ุ ฺฉูุฏ ููููุช\n\n๐ ุจุงูุฑ ุจู ุชูุงูุงโูุง ุฎูุฏ\n๐ ูุฑ ุดฺฉุณุชุ ูพู ุจู ุณู ูพุฑูุฒ\nโจ ุฑูุงูุงุช ุฑุง ุฏูุจุงู ฺฉู\n\nุจุฒุฑฺฏุชุฑู ฺุงูุด ุดูุง ุฏุฑ ูุณุฑ ููููุช ฺุณุชุ ๐ญ",
    "๐ฅ ุจุง [ููุถูุน] ุจู ุงูุฌ ุจุฑุณุฏ\n\nโก ูุฏุฑุช ุงุฑุงุฏู\n๐ฏ ุชูุฑฺฉุฒ ุจุฑ ูุฏู\n๐ซ ูุฑ ุฑูุฒุ ฺฉ ูุฏู ุจู ุฌูู\n\nฺู ฺุฒ ุจู ุดูุง ุงูฺฏุฒู ูโุฏูุฏุ ๐ช",
  ],

  // ููุถูุนุงุช ุชฺฉููููฺ
  technology: [
    "๐ป [ููุถูุน]ุ ุงูููุงุจ ุฏุฑ ุฏูุง ููุงูุฑ\n\n๐ ููุขูุฑ ุจโูพุงุงู\nโก ุณุฑุนุชุ ุฏูุชุ ฺฉุงุฑุง\n๐ ูฺฏุงู ุจู ุขูุฏู\n\nูุธุฑ ุดูุง ุฏุฑุจุงุฑู ุชุฃุซุฑ [ููุถูุน] ุจุฑ ุฒูุฏฺฏ ุฑูุฒูุฑู ฺุณุชุ ๐ค",
    "๐ฑ [ููุถูุน]ุ ุชุญูู ุฏุฑ ุฏูุง ุฏุฌุชุงู\n\n๐ก ุงุฏูโูุง ููุขูุฑุงูู\n๐ ุชุบุฑ ูุฏุงูู\nโ๏ธ ฺฉุงุฑุง ููุดููุฏุงูู\n\nฺุทูุฑ ุงุฒ [ููุถูุน] ุฏุฑ ุฒูุฏฺฏ ุฑูุฒูุฑู ุงุณุชูุงุฏู ูโฺฉูุฏุ ๐ญ",
  ],

  // ููุถูุนุงุช ุนููู
  default: [
    "โจ [ููุถูุน]ุ ุชุฌุฑุจูโุง ูุชูุงูุช\n\n๐ ูุญุธุงุช ุฎุงุต ุฒูุฏฺฏ\n๐ซ ฺฉุดู ุฏูุง ุฌุฏุฏ\n๐ ุฑูฺฏุงุฑูฺฏ ุชุฌุฑุจูโูุง\n\nูุธุฑ ุดูุง ุฏุฑุจุงุฑู [ููุถูุน] ฺุณุชุ ๐ญ",
    "๐ซ ุฌุงุฏู [ููุถูุน] ุฏุฑ ุฒูุฏฺฏ ุฑูุฒูุฑู\n\nโจ ูุฐุช ฺฉุดู ูุญุธุงุช ุฎุงุต\n๐ฟ ุขุฑุงูุด ุฏุฑ ุณุงุฏฺฏ\n๐ ุฑูฺฏโูุง ุฒูุฏฺฏ\n\nฺู ฺุฒ ุฏุฑ [ููุถูุน] ุชูุฌู ุดูุง ุฑุง ุฌูุจ ูโฺฉูุฏุ ๐",
  ],
}

// ูุดุชฺฏโูุง ูพุดโูุฑุถ ุจุฑุง ููุถูุนุงุช ูุฎุชูู
const defaultHashtags: Record<string, string[]> = {
  business: ["#ฺฉุณุจ_ู_ฺฉุงุฑ", "#ููููุช", "#ุงุณุชุฑุงุชฺ", "#ุฑุดุฏ", "#ููุขูุฑ"],
  lifestyle: ["#ุณุจฺฉ_ุฒูุฏฺฏ", "#ุฒูุฏฺฏ_ุณุงูู", "#ุขุฑุงูุด", "#ุดุงุฏ", "#ุชุนุงุฏู"],
  food: ["#ุบุฐุง_ุฎูุดูุฒู", "#ุขุดูพุฒ", "#ุฏุณุชูุฑ_ูพุฎุช", "#ุฎูุดูุฒู", "#ุบุฐุง_ุฎุงูฺฏ"],
  travel: ["#ุณูุฑ", "#ฺฏุฑุฏุดฺฏุฑ", "#ูุงุฌุฑุงุฌู", "#ุทุจุนุช_ฺฏุฑุฏ", "#ุฎุงุทุฑุงุช_ุณูุฑ"],
  art: ["#ููุฑ", "#ุฎูุงูุช", "#ุงููุงู", "#ุขูุฑูุด", "#ุจุงู_ููุฑ"],
  motivational: ["#ุงูฺฏุฒู", "#ููููุช", "#ูพุดุชฺฉุงุฑ", "#ูุฏู", "#ุฑุดุฏ_ูุฑุฏ"],
  technology: ["#ุชฺฉููููฺ", "#ููุงูุฑ", "#ููุขูุฑ", "#ุฏุฌุชุงู", "#ูพุดุฑูุช"],
  fashion: ["#ูุฏ", "#ุงุณุชุงู", "#ูุดู", "#ุฒุจุง", "#ุชุฑูุฏ"],
  health: ["#ุณูุงูุช", "#ุชูุงุณุจ_ุงูุฏุงู", "#ูุฑุฒุด", "#ุณูุงูุช_ุฑูุงู", "#ุฒูุฏฺฏ_ุณุงูู"],
  default: ["#ุฒูุฏฺฏ", "#ูุญุธุงุช_ุฎุงุต", "#ุชุฌุฑุจู", "#ุงุดุชุฑุงฺฉ", "#ุงููุงู"],
}

export function generateOfflineCaption(options: CaptionRequest): { caption: string; hashtags: string[] } {
  const { topic, style, length, includeHashtags } = options

  // ุชุนู ุฏุณุชู ููุถูุน
  let category = "default"
  if (topic.includes("ฺฉุณุจ") || topic.includes("ุชุฌุงุฑุช") || topic.includes("ูุฑูุด")) category = "business"
  else if (topic.includes("ุบุฐุง") || topic.includes("ุขุดูพุฒ") || topic.includes("ุฎูุฑุงฺฉ")) category = "food"
  else if (topic.includes("ุณูุฑ") || topic.includes("ฺฏุฑุฏุด") || topic.includes("ุทุจุนุช")) category = "travel"
  else if (topic.includes("ููุฑ") || topic.includes("ููุงุด") || topic.includes("ุฎูุงูุช")) category = "art"
  else if (topic.includes("ุงูฺฏุฒู") || topic.includes("ููููุช") || topic.includes("ูพุดุฑูุช")) category = "motivational"
  else if (topic.includes("ุชฺฉููููฺ") || topic.includes("ููุงูุฑ") || topic.includes("ุฏุฌุชุงู")) category = "technology"
  else if (topic.includes("ุณุจฺฉ") || topic.includes("ุฒูุฏฺฏ") || topic.includes("ุฑูุฒูุฑู")) category = "lifestyle"

  // ุงูุชุฎุงุจ ูุงูุจ ฺฉูพุดู ููุงุณุจ
  const templates = captionTemplates[category] || captionTemplates.default
  const templateIndex = Math.floor(Math.random() * templates.length)
  let captionTemplate = templates[templateIndex]

  // ุฌุงฺฏุฒู ููุถูุน ุฏุฑ ูุงูุจ
  captionTemplate = captionTemplate.replace(/\[ููุถูุน\]/g, topic)

  // ุชูุธู ุทูู ฺฉูพุดู
  if (length === "short") {
    // ุญุฐู ฺฉ ุง ุฏู ูพุงุฑุงฺฏุฑุงู ูุงู
    const lines = captionTemplate.split("\n\n")
    if (lines.length > 2) {
      captionTemplate = [lines[0], lines[lines.length - 1]].join("\n\n")
    }
  } else if (length === "long" && captionTemplate.split("\n\n").length < 4) {
    // ุงุถุงูู ฺฉุฑุฏู ูุญุชูุง ุจุดุชุฑ ุจุฑุง ฺฉูพุดูโูุง ุจููุฏ
    const extraContent: Record<string, string> = {
      business: "\n๐ผ ุงุณุชุฑุงุชฺโูุง ููุดููุฏุงูู ุจุฑุง ุฑุดุฏ\n๐ ุชุญูู ุฏุงุฏูโูุง ุจุฑุง ุชุตููโฺฏุฑ ุจูุชุฑ",
      lifestyle: "\n๐งโโ๏ธ ุชูุฑู ุฐููโุขฺฏุงู ุฏุฑ ุฒูุฏฺฏ ุฑูุฒูุฑู\n๐ฑ ุฑุดุฏ ุดุฎุต ุฏุฑ ูุณุฑ ุฒูุฏฺฏ",
      food: "\n๐ฝ๏ธ ุชุฑฺฉุจ ุทุนูโูุง ููุญุตุฑ ุจู ูุฑุฏ\n๐จโ๐ณ ุชฺฉูฺฉโูุง ุญุฑููโุง ุฏุฑ ุขุดูพุฒ ุฎุงูฺฏ",
      travel: "\n๐บ๏ธ ฺฉุดู ูฺฉุงูโูุง ฺฉูุชุฑ ุดูุงุฎุชู ุดุฏู\n๐ธ ุซุจุช ูุญุธุงุช ูุงุจ ุณูุฑ",
      art: "\n๐ญ ุจุงู ุงุญุณุงุณุงุช ุงุฒ ุทุฑู ููุฑ\n๐๏ธ ุชฺฉูฺฉโูุง ุฎูุงูุงูู ุฏุฑ ุขูุฑูุด",
      motivational: "\n๐ง ุฐููุช ุฑุดุฏ ู ุชูุณุนู ูุฑุฏ\nโฑ๏ธ ูุฏุฑุช ุฒูุงู ุจุฑุง ุฏุณุชุงุจ ุจู ุงูุฏุงู",
      technology: "\n๐ป ุขูุฏู ููุงูุฑ ู ุชุฃุซุฑ ุขู ุจุฑ ุฒูุฏฺฏ\n๐ ุณุงุฒฺฏุงุฑ ุจุง ุชุบุฑุงุช ุณุฑุน ุฏูุง ุฏุฌุชุงู",
      default: "\nโจ ฺฉุดู ุฒุจุงโูุง ูพููุงู ุฏุฑ ุฒูุฏฺฏ ุฑูุฒูุฑู\n๐ ุชุฌุฑุจูโูุง ูุชููุน ุจุฑุง ุฑุดุฏ ุดุฎุต",
    }

    const parts = captionTemplate.split("\n\n")
    const extraPart = extraContent[category as keyof typeof extraContent] || extraContent.default
    parts.splice(1, 0, extraPart)
    captionTemplate = parts.join("\n\n")
  }

  // ุชูุธู ุณุจฺฉ ฺฉูพุดู
  switch (style) {
    case "professional":
      captionTemplate = captionTemplate.replace(/๐|๐คค|๐/g, "")
      captionTemplate = captionTemplate.replace(/\?|๐/g, ".")
      break
    case "creative":
      // ุงุถุงูู ฺฉุฑุฏู ุงููุฌโูุง ุฎูุงูุงูู ุจุดุชุฑ
      captionTemplate = captionTemplate.replace(/\n/g, " โจ\n")
      break
    case "motivational":
      // ุงุถุงูู ฺฉุฑุฏู ุนุจุงุฑุงุช ุงูฺฏุฒุด
      if (!captionTemplate.includes("ูโุชูุงู")) {
        captionTemplate += "\n\n๐ซ ุชู ูโุชูุงู! ุจุงูุฑ ุฏุงุดุชู ุจุงุด ู ุงุฏุงูู ุจุฏู! ๐ช"
      }
      break
  }

  // ุงูุชุฎุงุจ ูุดุชฺฏโูุง
  let hashtags: string[] = []
  if (includeHashtags) {
    hashtags = [...(defaultHashtags[category] || defaultHashtags.default)]

    // ุงุถุงูู ฺฉุฑุฏู ูุดุชฺฏ ููุถูุน
    if (topic && !hashtags.includes(`#${topic}`)) {
      hashtags.push(`#${topic.replace(/\s+/g, "_")}`)
    }

    // ุงุถุงูู ฺฉุฑุฏู ูุดุชฺฏโูุง ูุฑุชุจุท ุจุง ุณุจฺฉ
    if (style === "motivational") {
      hashtags.push("#ุงูฺฏุฒุด", "#ุจุงูุฑ_ุฏุงุดุชู_ุจุงุด")
    } else if (style === "creative") {
      hashtags.push("#ุฎูุงูุช", "#ููุฑููุฏุงูู")
    } else if (style === "professional") {
      hashtags.push("#ุญุฑููโุง", "#ุชุฎุตุต")
    }
  }

  return {
    caption: captionTemplate,
    hashtags: hashtags,
  }
}

// ุชุงุจุน ุงุตู ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ ุจุฑูุงูู
export async function generateCaption(options: CaptionRequest): Promise<CaptionResponse> {
  try {
    const result = generateOfflineCaption(options)

    return {
      caption: result.caption,
      hashtags: result.hashtags,
      success: true,
    }
  } catch (error) {
    console.error("Error generating offline caption:", error)
    return {
      caption: "ุฎุทุง ุฏุฑ ุชููุฏ ฺฉูพุดู. ูุทูุงู ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ.",
      hashtags: [],
      success: false,
    }
  }
}
